import{Q as B}from"./QPage.a823ad4e.js";import{v as $,l as M,F as A,d as D,h as N,i as P,x as h,r as E,as as Q,o as y,c as _,w as I,a as i,u as t,f as V,I as T,af as O,N as U,z as F,D as f,k as L,Q as j,p as c,t as g,b as x,q as z,g as H,O as K,m as G,n as R,B as J,C as W}from"./index.09dd2b81.js";import{u as X,Q as Y}from"./index.fe6b57fc.js";import{a as Z,b as ee}from"./validators.06a91c63.js";import"./index.9835d912.js";const q=$({id:"take-measurements",state:()=>({measurementCards:[]}),actions:{async updateTakeMeasurementCards(e){const s=(await e.getAll(M.MEASUREMENTS)).sort((a,r)=>a.name.localeCompare(r.name));this.measurementCards=await Promise.all(s.map(async a=>{const r=await e.getNewestByField(M.MEASUREMENT_RECORDS,A.PARENT_ID,a.id);return{id:a.id,name:a.name,measurementType:a.measurementType,previousCreatedDate:r==null?void 0:r.createdDate,previousMeasurementValue:r==null?void 0:r.measurementValue}}))}}}),ae=D({__name:"SaveMeasurementInput",props:{parentId:null,measurementType:null,name:null},setup(e){const s=e,{log:a}=N(),{confirmDialog:r}=P(),C=q(),n=h(),p=E(null),m=E(null),u=E([]);try{s.measurementType===Q.PERCENT?u.value.push(o=>Z(Number(o))||"Value between 0 and 100 required"):u.value.push(o=>ee(Number(o))||"Positive number required")}catch(o){a.error("SaveMeasurementInput:Setup",o)}async function d(){r("Save","Are you sure you want to save this measurement?",T.SAVE,U.INFO,async()=>{try{n.temporaryItem.id=F(),n.temporaryItem.createdDate=new Date().toISOString(),n.temporaryItem.parentId=s.parentId,n.temporaryItem.measurementValue=Number(m.value),await f.callCreate(M.MEASUREMENT_RECORDS,{id:n.temporaryItem.id,createdDate:n.temporaryItem.createdDate,parentId:n.temporaryItem.parentId,measurementValue:n.temporaryItem.measurementValue}),a.info(`Saved ${s.name} (${Number(m.value)} ${s.measurementType})`,{name:"SaveMeasurement:Info"}),await C.updateTakeMeasurementCards(f),n.closeDialog(f),m.value=null}catch(o){a.error("SaveMeasurementInput:onSave",o)}})}function S(){var o;return!!((o=p==null?void 0:p.value)!=null&&o.validate())}return(o,l)=>(y(),_(t(O),{type:"number",ref_key:"inputRef",ref:p,class:"q-mt-md",rules:u.value,modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=v=>m.value=v),dense:"",outlined:"",placeholder:e.measurementType,onBlur:l[2]||(l[2]=v=>S())},{after:I(()=>[i(t(V),{disable:!m.value||!S(),color:"positive",class:"q-ml-sm q-px-sm",icon:t(T).SAVE,onClick:l[0]||(l[0]=v=>d())},null,8,["disable","icon"])]),_:1},8,["rules","modelValue","placeholder"]))}}),te={class:"text-h6 q-mb-sm"},re={class:"text-caption q-ml-xs"},se={class:"text-caption q-ml-xs"},ne=D({__name:"TakeMeasurementCard",props:{measurementCard:null},setup(e){var m;const s=e,{log:a}=N(),r=h(),C=E(new Date(((m=s.measurementCard)==null?void 0:m.previousCreatedDate)||"")),n=X(C);L(()=>{var u;C.value=new Date(((u=s.measurementCard)==null?void 0:u.previousCreatedDate)||"")});async function p(){var u;try{const d=await f.getFirstByField(M.MEASUREMENTS,A.ID,(u=s.measurementCard)==null?void 0:u.id);r.openDialog(M.MEASUREMENTS,K.REPORT,d)}catch(d){a.error("TakeMeasurementCard:onReportDialog",d)}}return(u,d)=>(y(),_(t(H),null,{default:I(()=>[i(t(j),{class:"q-pt-sm"},{default:I(()=>{var S,o,l,v,k,b,w;return[c("div",te,g((S=e.measurementCard)==null?void 0:S.name),1),i(t(V),{round:"",flat:"",icon:t(T).REPORT,class:"absolute-top-right q-ma-sm",onClick:d[0]||(d[0]=le=>p())},null,8,["icon"]),c("div",null,[i(t(Y),{class:"q-py-xs q-mb-xs",rounded:"",color:"grey-9",label:t(n)||"never"},null,8,["label"])]),c("div",null,[i(t(x),{name:t(T).CALENDAR_CHECK},null,8,["name"]),c("span",re,g(t(z)((o=e.measurementCard)==null?void 0:o.previousCreatedDate)||"-"),1)]),c("div",null,[i(t(x),{name:t(T).MEASUREMENTS},null,8,["name"]),c("span",se,g(((l=e.measurementCard)==null?void 0:l.previousMeasurementValue)||"-")+" "+g((v=e.measurementCard)==null?void 0:v.measurementType),1)]),i(ae,{parentId:(k=e.measurementCard)==null?void 0:k.id,measurementType:(b=e.measurementCard)==null?void 0:b.measurementType,name:(w=e.measurementCard)==null?void 0:w.name},null,8,["parentId","measurementType","name"])]}),_:1})]),_:1}))}}),oe=D({__name:"TakeMeasurementsList",setup(e){const{log:s}=N(),a=q();return G(async()=>{try{await a.updateTakeMeasurementCards(f)}catch(r){s.error("TakeMeasurementsList:onMounted",r)}}),(r,C)=>(y(!0),R(W,null,J(t(a).measurementCards,n=>(y(),R("div",{key:n.id,class:"col-md-4 col-sm-6 col-xs-12"},[i(ne,{measurementCard:n},null,8,["measurementCard"])]))),128))}}),ue={class:"row q-col-gutter-md justify-start"},me=D({__name:"TakeMeasurementsPage",setup(e){return(s,a)=>(y(),_(t(B),{padding:""},{default:I(()=>[c("div",ue,[i(oe)])]),_:1}))}}),ye=D({__name:"TakeMeasurementsView",setup(e){return(s,a)=>(y(),_(me))}});export{ye as default};
