import{Q as te}from"./QPage.6bf7e2ad.js";import{a8 as ne,x as D,a9 as Z,i as re,m as B,n as se,aa as oe,u as o,G as S,d as h,s as q,v as ue,ab as z,ac as le,o as C,c as R,w as P,a as v,g as J,I as $,Z as ie,N as me,ad as ce,D as x,ae as de,Q as fe,f as I,t as N,b as Q,af as pe,h as ve,ag as ye,ah as _e,B as V,ai as ge,F as Ie}from"./index.66b77c2e.js";import{r as we,u as Oe,i as Se,t as Ce,a as be}from"./index.e1937689.js";import{i as Ee,a as Te}from"./validators.13905387.js";const X=ne({id:"take-measurements",state:()=>({measurementCards:[]}),actions:{async updateMeasurementCards(e){const a=(await e.getAll(D.MEASUREMENTS)).sort((t,n)=>t.name.localeCompare(n.name));this.measurementCards=await Promise.all(a.map(async t=>{const n=await e.getNewestByField(D.MEASUREMENT_RECORDS,Z.PARENT_ID,t.id);return{id:t.id,name:t.name,measurementType:t.measurementType,previousCreatedDate:n==null?void 0:n.createdDate,previousMeasurementValue:n==null?void 0:n.measurementValue}}))}}}),$e=["top","middle","bottom"],xe=re({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>$e.includes(e)}},setup(e,{slots:a}){const t=B(()=>e.align!==void 0?{verticalAlign:e.align}:null),n=B(()=>{const s=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(s!==void 0?` text-${s}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>se("div",{class:n.value,style:t.value,role:"status","aria-label":e.label},oe(a.default,e.label!==void 0?[e.label]:[]))}}),De=be?window:void 0,F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k="__vueuse_ssr_handlers__";F[k]=F[k]||{};F[k];function he(e,a={}){const{immediate:t=!0,window:n=De}=a,s=S(!1);let r=null;function m(){!s.value||!n||(e(),r=n.requestAnimationFrame(m))}function i(){!s.value&&n&&(s.value=!0,m())}function u(){s.value=!1,r!=null&&n&&(n.cancelAnimationFrame(r),r=null)}return t&&i(),Ce(u),{isActive:s,pause:u,resume:i}}var Me=Object.defineProperty,U=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,j=(e,a,t)=>a in e?Me(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,Ae=(e,a)=>{for(var t in a||(a={}))Ne.call(a,t)&&j(e,t,a[t]);if(U)for(var t of U(a))Pe.call(a,t)&&j(e,t,a[t]);return e};function Re(e={}){const{controls:a=!1,interval:t="requestAnimationFrame"}=e,n=S(new Date),s=()=>n.value=new Date,r=t==="requestAnimationFrame"?he(s,{immediate:!0}):Oe(s,t,{immediate:!0});return a?Ae({now:n},r):n}var L;(function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT",e.NONE="NONE"})(L||(L={}));var Be=Object.defineProperty,A=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,G=(e,a,t)=>a in e?Be(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,Fe=(e,a)=>{for(var t in a||(a={}))Y.call(a,t)&&G(e,t,a[t]);if(A)for(var t of A(a))ee.call(a,t)&&G(e,t,a[t]);return e},ke=(e,a)=>{var t={};for(var n in e)Y.call(e,n)&&a.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&A)for(var n of A(e))a.indexOf(n)<0&&ee.call(e,n)&&(t[n]=e[n]);return t};const H=[{max:6e4,value:1e3,name:"second"},{max:276e4,value:6e4,name:"minute"},{max:72e6,value:36e5,name:"hour"},{max:5184e5,value:864e5,name:"day"},{max:24192e5,value:6048e5,name:"week"},{max:28512e6,value:2592e6,name:"month"},{max:1/0,value:31536e6,name:"year"}],qe={justNow:"just now",past:e=>e.match(/\d/)?`${e} ago`:e,future:e=>e.match(/\d/)?`in ${e}`:e,month:(e,a)=>e===1?a?"last month":"next month":`${e} month${e>1?"s":""}`,year:(e,a)=>e===1?a?"last year":"next year":`${e} year${e>1?"s":""}`,day:(e,a)=>e===1?a?"yesterday":"tomorrow":`${e} day${e>1?"s":""}`,week:(e,a)=>e===1?a?"last week":"next week":`${e} week${e>1?"s":""}`,hour:e=>`${e} hour${e>1?"s":""}`,minute:e=>`${e} minute${e>1?"s":""}`,second:e=>`${e} second${e>1?"s":""}`},Qe=e=>e.toISOString().slice(0,10);function Ve(e,a={}){const{controls:t=!1,max:n,updateInterval:s=3e4,messages:r=qe,fullDateFormatter:m=Qe,showSecond:i=!1}=a,{abs:u,round:d}=Math,y=Re({interval:s,controls:!0}),{now:l}=y,c=ke(y,["now"]);function _(p,g){var w;const f=+g-+p,O=u(f);if(O<6e4&&!i)return r.justNow;if(typeof n=="number"&&O>n)return m(new Date(p));if(typeof n=="string"){const T=(w=H.find(ae=>ae.name===n))==null?void 0:w.max;if(T&&O>T)return m(new Date(p))}for(const T of H)if(O<T.max)return M(f,T)}function b(p,g,w){const f=r[p];return typeof f=="function"?f(g,w):f.replace("{0}",g.toString())}function M(p,g){const w=d(u(p)/g.value),f=p>0,O=b(g.name,w,f);return b(f?"past":"future",O,f)}const E=B(()=>_(new Date(we(e)),o(l.value)));return t?Fe({timeAgo:E},c):E}var Ue=Object.defineProperty,W=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable,K=(e,a,t)=>a in e?Ue(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,Ge=(e,a)=>{for(var t in a||(a={}))je.call(a,t)&&K(e,t,a[t]);if(W)for(var t of W(a))Le.call(a,t)&&K(e,t,a[t]);return e};const He={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};Ge({linear:Se},He);const We=h({__name:"SaveMeasurementInput",props:{parentId:null,measurementType:null,name:null},setup(e){const a=e,{log:t}=q(),{confirmDialog:n}=ue(),s=X(),r=z(),m=S(null),i=S(null),u=S([]);try{a.measurementType===le.PERCENT?u.value.push(l=>Ee(Number(l))||"Value between 0 and 100 required"):u.value.push(l=>Te(Number(l))||"Positive number required")}catch(l){t.error("SaveMeasurementInput:Setup",l)}async function d(){n("Save","Are you sure you want to save this measurement?",$.SAVE,me.INFO,async()=>{try{r.temporaryItem.id=ce(),r.temporaryItem.createdDate=new Date().toISOString(),r.temporaryItem.parentId=a.parentId,r.temporaryItem.measurementValue=Number(i.value),await x.callCreate(D.MEASUREMENT_RECORDS,{id:r.temporaryItem.id,createdDate:r.temporaryItem.createdDate,parentId:r.temporaryItem.parentId,measurementValue:r.temporaryItem.measurementValue}),t.info(`Saved ${a.name} (${Number(i.value)} ${a.measurementType})`,{name:"SaveMeasurement:Info"}),await s.updateMeasurementCards(x),r.closeDialog(x),i.value=null}catch(l){t.error("SaveMeasurementInput:onSave",l)}})}function y(){var l;return!!((l=m==null?void 0:m.value)!=null&&l.validate())}return(l,c)=>(C(),R(o(ie),{type:"number",ref_key:"inputRef",ref:m,class:"q-mt-md",rules:u.value,modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=_=>i.value=_),dense:"",outlined:"",placeholder:e.measurementType,onBlur:c[2]||(c[2]=_=>y())},{after:P(()=>[v(o(J),{disable:!i.value||!y(),color:"positive",class:"q-ml-sm q-px-sm",icon:o($).SAVE,onClick:c[0]||(c[0]=_=>d())},null,8,["disable","icon"])]),_:1},8,["rules","modelValue","placeholder"]))}}),Ke={class:"text-h6"},Ze={class:"text-caption q-ml-xs"},ze={class:"text-caption q-ml-xs"},Je=h({__name:"TakeMeasurementCard",props:{measurementCard:null},setup(e){var i;const a=e,{log:t}=q(),n=z(),s=S(new Date(((i=a.measurementCard)==null?void 0:i.previousCreatedDate)||"")),r=Ve(s);de(()=>{var u;s.value=new Date(((u=a.measurementCard)==null?void 0:u.previousCreatedDate)||"")});async function m(){var u;try{const d=await x.getFirstByField(D.MEASUREMENTS,Z.ID,(u=a.measurementCard)==null?void 0:u.id);n.openDialog(D.MEASUREMENTS,ye.REPORT,d)}catch(d){t.error("TakeMeasurementCard:onReportDialog",d)}}return(u,d)=>(C(),R(o(ve),null,{default:P(()=>[v(o(fe),{class:"q-pt-sm"},{default:P(()=>{var y,l,c,_,b,M,E;return[I("div",Ke,N((y=e.measurementCard)==null?void 0:y.name),1),v(o(J),{round:"",flat:"",icon:o($).REPORT,class:"absolute-top-right q-ma-sm",onClick:d[0]||(d[0]=p=>m())},null,8,["icon"]),I("div",null,[v(o(xe),{rounded:"",color:"grey-9",label:o(r)||"never"},null,8,["label"])]),I("div",null,[v(o(Q),{name:o($).CALENDAR_CHECK},null,8,["name"]),I("span",Ze,N(o(pe)((l=e.measurementCard)==null?void 0:l.previousCreatedDate)||"-"),1)]),I("div",null,[v(o(Q),{name:o($).MEASUREMENTS},null,8,["name"]),I("span",ze,N(((c=e.measurementCard)==null?void 0:c.previousMeasurementValue)||"-")+" "+N((_=e.measurementCard)==null?void 0:_.measurementType),1)]),v(We,{parentId:(b=e.measurementCard)==null?void 0:b.id,measurementType:(M=e.measurementCard)==null?void 0:M.measurementType,name:(E=e.measurementCard)==null?void 0:E.name},null,8,["parentId","measurementType","name"])]}),_:1})]),_:1}))}}),Xe=h({__name:"TakeMeasurementsList",setup(e){const{log:a}=q(),t=X();return _e(async()=>{try{await t.updateMeasurementCards(x)}catch(n){a.error("TakeMeasurementsList:onMounted",n)}}),(n,s)=>(C(!0),V(Ie,null,ge(o(t).measurementCards,r=>(C(),V("div",{key:r.id,class:"col-md-4 col-sm-6 col-xs-12"},[v(Je,{measurementCard:r},null,8,["measurementCard"])]))),128))}}),Ye={class:"row q-col-gutter-md justify-start"},ea=h({__name:"TakeMeasurementsPage",setup(e){return(a,t)=>(C(),R(o(te),{padding:""},{default:P(()=>[I("div",Ye,[v(Xe)])]),_:1}))}}),sa=h({__name:"TakeMeasurementsView",setup(e){return(a,t)=>(C(),R(ea))}});export{sa as default};
